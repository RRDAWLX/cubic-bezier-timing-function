{"version":3,"file":"cbtf.js","sources":["../index.js"],"sourcesContent":["const presets = {\r\n  'linear': [0, 0, 1, 1],\r\n  'ease': [0.25, 0.1, 0.25, 1],\r\n  'ease-in': [0.42, 0, 1, 1],\r\n  'ease-out': [0, 0, 0.58, 1],\r\n  'ease-in-out': [0.42, 0, 0.58, 1]\r\n};\r\n\r\n/**\r\n * @function cubicBezierTimingFunction 三次贝塞尔曲线函数生成器，根据点 P1，P2 以及精度 precision，生成一条三次贝塞尔曲线的对应函数。\r\n * @param {string} x1 三次贝塞尔曲线预设值名，未匹配到则默认为 'linear'\r\n * @param {number} x1 三次贝塞尔曲线中点 P1 的横坐标\r\n * @param {number} y1 三次贝塞尔曲线中点 P1 的纵坐标\r\n * @param {number} x2 三次贝塞尔曲线中点 P2 的横坐标\r\n * @param {number} y2 三次贝塞尔曲线中点 P2 的纵坐标\r\n * @param {number} precision 近似解的精度，默认值为 1e-5\r\n * @return {function} 三次贝塞尔曲线对应的函数\r\n */\r\nexport default function cubicBezierTimingFunction(x1, y1, x2, y2, precision) {\r\n  if (typeof x1 === 'string') {\r\n    precision = y1;\r\n    let preset = presets[x1] || presets.linear;\r\n    x1 = preset[0];\r\n    y1 = preset[1];\r\n    x2 = preset[2];\r\n    y2 = preset[3];\r\n  } else if (x1 < 0 || x1 > 1 || x2 < 0 || x2 > 1) {\r\n    x1 = presets.linear[0];\r\n    y1 = presets.linear[1];\r\n    x2 = presets.linear[2];\r\n    y2 = presets.linear[3];\r\n\r\n    if (console && console.warn) {\r\n      console.warn('x1、x2应该在闭区间[0, 1]中取值');\r\n    }\r\n  }\r\n\r\n  precision = precision || 1e-5;\r\n\r\n  const pow = Math.pow;\r\n  const abs = Math.abs;\r\n\r\n  /**\r\n   * @function yFn 三次贝塞尔曲线 y 坐标的函数。\r\n   * @param {number} t 贝塞尔曲线的绘制比例，t ∈ [0, 1]。\r\n   * @return {number} 贝塞尔曲线上 t 对应的点的 y 坐标。\r\n   */\r\n  const yFn = (() => {\r\n    // 3 * (1 - t) ^ 2 * t * y1 + 3 * (1 - t) * t ^ 2 * y2 + t ^ 3\r\n    // 3 * pow(1 - t, 2) * t * y1 + 3 * (1 - t) * pow(t, 2) * y2 + pow(t, 3);\r\n    // (3 * y1 - 3 * y2 + 1) * pow(t, 3) + (3 * y2 - 6 * y1) * pow(t, 2) + 3 * y1 * t;\r\n    let a = 3 * y1 - 3 * y2 + 1;\r\n    let b = 3 * y2 - 6 * y1;\r\n    let c = 3 * y1;\r\n    return t => a * pow(t, 3) + b * pow(t, 2) + c * t;\r\n  })();\r\n\r\n  /**\r\n   * @function xFn 三次贝塞尔曲线 x 坐标的函数。\r\n   * @param {number} t 贝塞尔曲线的绘制比例，t ∈ [0, 1]。\r\n   * @return {number} 贝塞尔曲线上 t 对应的点的 x 坐标。\r\n   */\r\n  const xFn = (() => {\r\n    // 3 * (1 - t) ^ 2 * t * x1 + 3 * (1 - t) * t ^ 2 * x2 + t ^ 3\r\n    // 3 * pow(1 - t, 2) * t * x1 + 3 * (1 - t) * pow(t, 2) * x2 + pow(t, 3);\r\n    // (3 * x1 - 3 * x2 + 1) * pow(t, 3) + (3 * x2 - 6 * x1) * pow(t, 2) + 3 * x1 * t;\r\n    let a = 3 * x1 - 3 * x2 + 1;\r\n    let b = 3 * x2 - 6 * x1;\r\n    let c = 3 * x1;\r\n    return t => a * pow(t, 3) + b * pow(t, 2) + c * t;\r\n  })();\r\n\r\n  /**\r\n   * @function derivativeXFn 三次贝塞尔曲线 x 坐标的函数的导函数。\r\n   * @param {number} t 贝塞尔曲线的绘制比例，t ∈ [0, 1]。\r\n   * @return {number} 贝塞尔曲线上 t 对应的点上的切线的斜率。\r\n   */\r\n  const derivativeXFn = (() => {\r\n    // 3 * pow(1 - t, 2) * x1 + 6 * (1 - t) * t * (x2 - x1) + 3 * pow(t, 2) * (1 - x2);\r\n    // (9 * x1 - 9 * x2 + 3) * pow(t, 2) + (6 * x2 - 12 * x1) * t + 3 * x1;\r\n    let a = 9 * x1 - 9 * x2 + 3;\r\n    let b = 6 * x2 - 12 * x1;\r\n    let c = 3 * x1;\r\n    return t => a * pow(t, 2) + b * t + c;\r\n  })();\r\n\r\n  /**\r\n   * @function resolveT 根据给定的横坐标 x，求相应的三次贝塞尔曲线的绘制比例 t（近似解）。\r\n   * @param {number} x 横坐标，x ∈ [0, 1]。\r\n   * @return {number} 贝塞尔曲线的绘制比例 t。\r\n   */\r\n  // 牛顿法\r\n  function resolveT(x) {\r\n    // 用牛顿法求函数的近似解，可参考《人教版高中数学选修2-2》1.2导数的计算中的探究与发现“牛顿法——用导数方法求方程的近似解”\r\n    let t0;\r\n    let t1 = x;\r\n\r\n    do {\r\n      t0 = t1;\r\n      t1 = t0 - (xFn(t0) - x) / derivativeXFn(t0);\r\n    } while (abs((t1 - t0) / t0) > precision);\r\n\r\n    return t1;\r\n  }\r\n\r\n  // 夹逼法\r\n  /* function resolveT(x) {\r\n    let left = 0;\r\n    let right = 1;\r\n    let t;\r\n    let approximateX;\r\n\r\n    // 夹逼法求t的近似解\r\n    while (left < right) {\r\n      t = (left + right) / 2;\r\n      approximateX = xFn(t);\r\n      if (abs(x - approximateX) < precision) {\r\n        return t;\r\n      } else if (x < approximateX) {\r\n        right = t;\r\n      } else {\r\n        left = t;\r\n      }\r\n    }\r\n\r\n    return t;\r\n  } */\r\n\r\n  /**\r\n   * 三次贝塞尔曲线的函数，可根据给定的横坐标 x 求对应的纵坐标 y。\r\n   */\r\n  return function (x) {\r\n    if (x <= 0) {\r\n      return 0;\r\n    }\r\n\r\n    if (x >= 1) {\r\n      return 1;\r\n    }\r\n\r\n    return yFn(resolveT(x));\r\n  };\r\n}\r\n"],"names":[],"mappings":"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"}